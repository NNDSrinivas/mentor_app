<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📄 Resume & Profile Manager - AI Interview Assistant</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .upload-area {
            border: 3px dashed rgba(0, 255, 0, 0.5);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-area:hover {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }
        .upload-area.dragover {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.2);
            transform: scale(1.02);
        }
        .profile-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #00ff00;
        }
        .form-group {
            margin: 15px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #00ff00;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(0, 255, 0, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 14px;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #00ff00;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            background: #00ff00;
            color: black;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #00dd00;
            transform: translateY(-2px);
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        .skills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .skill-tag {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            border: 1px solid rgba(0, 255, 0, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .skill-tag:hover {
            background: rgba(0, 255, 0, 0.3);
        }
        .skill-tag.selected {
            background: #00ff00;
            color: black;
        }
        .analysis-result {
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            border-left: 4px solid #00ff00;
            white-space: pre-wrap;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 255, 0, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #00dd00);
            width: 0%;
            transition: width 0.3s ease;
        }
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        .preview-section {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(0, 255, 0, 0.3);
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        .status-warning {
            background: #ffaa00;
            box-shadow: 0 0 10px #ffaa00;
        }
        .status-error {
            background: #ff0000;
            box-shadow: 0 0 10px #ff0000;
        }
        .file-info {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid #00ff00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📄 Resume & Profile Manager</h1>
        <p><strong>Upload your resume and build your profile so the AI can give personalized interview answers based on YOUR actual experience!</strong></p>
        
        <!-- Resume Upload Section -->
        <div class="profile-section">
            <h2>📤 Upload Resume</h2>
            <div class="upload-area" id="uploadArea">
                <div style="font-size: 48px; margin-bottom: 15px;">📄</div>
                <h3>Drop your resume here or click to browse</h3>
                <p>Supports: PDF, DOC, DOCX, TXT</p>
                <p style="font-size: 12px; color: #aaa;">The AI will analyze your resume to understand your experience, skills, and background</p>
                <input type="file" id="resumeFile" accept=".pdf,.doc,.docx,.txt" style="display: none;">
            </div>
            
            <div id="uploadProgress" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="uploadStatus">Processing...</p>
            </div>
            
            <div id="resumeAnalysis" style="display: none;">
                <h3>📊 Resume Analysis Complete</h3>
                <div class="analysis-result" id="analysisResult"></div>
            </div>
        </div>

        <!-- Personal Profile Section -->
        <div class="two-column">
            <div class="profile-section">
                <h2>👤 Personal Information</h2>
                
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" placeholder="e.g., Naga Mounika Kapa" value="Naga Mounika Kapa">
                </div>
                
                <div class="form-group">
                    <label for="currentRole">Current Role/Title</label>
                    <input type="text" id="currentRole" placeholder="e.g., Software Developer, Data Scientist">
                </div>
                
                <div class="form-group">
                    <label for="experienceYears">Years of Experience</label>
                    <select id="experienceYears">
                        <option value="">Select experience</option>
                        <option value="0-1">0-1 years (Entry level)</option>
                        <option value="1-3">1-3 years (Junior)</option>
                        <option value="3-5">3-5 years (Mid-level)</option>
                        <option value="5-8">5-8 years (Senior)</option>
                        <option value="8+">8+ years (Expert/Lead)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" placeholder="e.g., New York, NY">
                </div>
            </div>

            <div class="profile-section">
                <h2>💼 Professional Background</h2>
                
                <div class="form-group">
                    <label for="currentCompany">Current/Recent Company</label>
                    <input type="text" id="currentCompany" placeholder="e.g., Google, Microsoft, Startup">
                </div>
                
                <div class="form-group">
                    <label for="industry">Industry/Domain</label>
                    <select id="industry">
                        <option value="">Select industry</option>
                        <option value="technology">Technology/Software</option>
                        <option value="finance">Finance/Banking</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="ecommerce">E-commerce</option>
                        <option value="consulting">Consulting</option>
                        <option value="education">Education</option>
                        <option value="gaming">Gaming</option>
                        <option value="ai-ml">AI/Machine Learning</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="careerGoals">Career Goals/Interests</label>
                    <textarea id="careerGoals" placeholder="What are you looking for in your next role? What excites you professionally?"></textarea>
                </div>
            </div>
        </div>

        <!-- Technical Skills Section -->
        <div class="profile-section">
            <h2>⚙️ Technical Skills</h2>
            <p>Select your skills and proficiency levels. The AI will reference these during interviews.</p>
            
            <div class="form-group">
                <label>Programming Languages</label>
                <div class="skills-container" id="programmingSkills">
                    <div class="skill-tag" data-skill="python">Python</div>
                    <div class="skill-tag" data-skill="javascript">JavaScript</div>
                    <div class="skill-tag" data-skill="java">Java</div>
                    <div class="skill-tag" data-skill="typescript">TypeScript</div>
                    <div class="skill-tag" data-skill="react">React</div>
                    <div class="skill-tag" data-skill="nodejs">Node.js</div>
                    <div class="skill-tag" data-skill="sql">SQL</div>
                    <div class="skill-tag" data-skill="nosql">NoSQL</div>
                    <div class="skill-tag" data-skill="aws">AWS</div>
                    <div class="skill-tag" data-skill="docker">Docker</div>
                    <div class="skill-tag" data-skill="kubernetes">Kubernetes</div>
                    <div class="skill-tag" data-skill="git">Git</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="additionalSkills">Additional Skills (comma-separated)</label>
                <textarea id="additionalSkills" placeholder="e.g., Machine Learning, Data Analysis, Project Management, Agile, REST APIs"></textarea>
            </div>
        </div>

        <!-- Experience & Projects Section -->
        <div class="profile-section">
            <h2>🚀 Key Experience & Projects</h2>
            
            <div class="form-group">
                <label for="keyProjects">Notable Projects</label>
                <textarea id="keyProjects" placeholder="Describe 2-3 key projects you've worked on. Include technologies used, your role, and impact/results."></textarea>
            </div>
            
            <div class="form-group">
                <label for="achievements">Key Achievements</label>
                <textarea id="achievements" placeholder="What are you most proud of? Promotions, awards, successful launches, problem-solving wins, etc."></textarea>
            </div>
            
            <div class="form-group">
                <label for="challenges">Interesting Challenges Solved</label>
                <textarea id="challenges" placeholder="Describe technical or business challenges you've overcome. These make great interview stories!"></textarea>
            </div>
        </div>

        <!-- Interview Preferences -->
        <div class="profile-section">
            <h2>🎯 Interview Preferences</h2>
            
            <div class="form-group">
                <label for="communicationStyle">Communication Style</label>
                <select id="communicationStyle">
                    <option value="confident">Confident & Direct</option>
                    <option value="thoughtful">Thoughtful & Analytical</option>
                    <option value="conversational">Conversational & Friendly</option>
                    <option value="technical">Technical & Detailed</option>
                    <option value="concise">Concise & To-the-point</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="responseLength">Preferred Response Length</label>
                <select id="responseLength">
                    <option value="brief">Brief (1-2 sentences)</option>
                    <option value="medium">Medium (2-3 sentences)</option>
                    <option value="detailed">Detailed (3-4 sentences)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="personalityTraits">Personality Traits to Emphasize</label>
                <textarea id="personalityTraits" placeholder="e.g., Problem-solver, Team player, Quick learner, Detail-oriented, Innovation-focused"></textarea>
            </div>
        </div>

        <!-- Action Buttons -->
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="saveProfile()" id="saveBtn">💾 Save Profile</button>
            <button onclick="testAIPersonalization()" id="testBtn">🧪 Test AI Personalization</button>
            <button onclick="exportProfile()" id="exportBtn">📤 Export Profile</button>
            <button onclick="clearProfile()" id="clearBtn" style="background: #ff6b6b;">🗑️ Clear All</button>
        </div>

        <!-- Preview Section -->
        <div class="preview-section" id="previewSection" style="display: none;">
            <h3>🔮 AI Personalization Preview</h3>
            <div id="personalizedExample"></div>
        </div>

        <!-- Status Section -->
        <div id="statusSection" style="margin-top: 20px;">
            <h3>📊 Profile Status</h3>
            <div id="profileStatus">
                <span class="status-indicator status-warning"></span>Profile incomplete - Fill in your information above
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let profileData = {};
        let selectedSkills = new Set();
        let resumeAnalyzed = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadExistingProfile();
            setupEventListeners();
            setupDragAndDrop();
        });

        function setupEventListeners() {
            // Skill selection
            document.querySelectorAll('.skill-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    const skill = this.dataset.skill;
                    if (selectedSkills.has(skill)) {
                        selectedSkills.delete(skill);
                        this.classList.remove('selected');
                    } else {
                        selectedSkills.add(skill);
                        this.classList.add('selected');
                    }
                    updateProfileStatus();
                });
            });

            // File input
            document.getElementById('resumeFile').addEventListener('change', handleFileUpload);
            document.getElementById('uploadArea').addEventListener('click', () => {
                document.getElementById('resumeFile').click();
            });

            // Form changes
            document.querySelectorAll('input, textarea, select').forEach(field => {
                field.addEventListener('change', updateProfileStatus);
                field.addEventListener('input', updateProfileStatus);
            });
        }

        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload({ target: { files } });
                }
            });
        }

        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const uploadProgress = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('progressFill');
            const uploadStatus = document.getElementById('uploadStatus');

            uploadProgress.style.display = 'block';
            
            try {
                // Simulate progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 20;
                    if (progress > 90) progress = 90;
                    progressFill.style.width = progress + '%';
                    uploadStatus.textContent = progress < 50 ? 'Uploading...' : 'Analyzing resume...';
                }, 200);

                // Upload and analyze resume
                const formData = new FormData();
                formData.append('resume', file);

                const response = await fetch('http://localhost:8084/api/upload-resume', {
                    method: 'POST',
                    body: formData
                });

                clearInterval(progressInterval);
                progressFill.style.width = '100%';
                uploadStatus.textContent = 'Complete!';

                if (response.ok) {
                    const result = await response.json();
                    showResumeAnalysis(result);
                    resumeAnalyzed = true;
                    
                    // Wait a moment for the backend to save the profile, then reload it
                    setTimeout(async () => {
                        await loadExistingProfile();
                        showNotification('✅ Resume analyzed and profile auto-populated!', 'success');
                    }, 1000);
                    
                    updateProfileStatus();
                } else {
                    throw new Error('Upload failed');
                }

            } catch (error) {
                console.error('Resume upload failed:', error);
                uploadStatus.textContent = 'Upload failed - ' + error.message;
                uploadStatus.style.color = '#ff6b6b';
            }
        }

        function showResumeAnalysis(result) {
            const analysisSection = document.getElementById('resumeAnalysis');
            const analysisResult = document.getElementById('analysisResult');
            
            analysisResult.textContent = JSON.stringify(result, null, 2);
            analysisSection.style.display = 'block';

            // Don't try to auto-fill here - let loadExistingProfile() handle it
            // The backend has already updated the profile, so we'll load it fresh
            console.log('Resume analysis result:', result);
        }

        async function saveProfile() {
            const profile = gatherProfileData();
            
            try {
                const response = await fetch('http://localhost:8084/api/save-profile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(profile)
                });

                if (response.ok) {
                    showNotification('✅ Profile saved successfully!', 'success');
                    updateProfileStatus();
                } else {
                    throw new Error('Failed to save profile');
                }
            } catch (error) {
                showNotification('❌ Failed to save profile: ' + error.message, 'error');
            }
        }

        async function testAIPersonalization() {
            const profile = gatherProfileData();
            
            try {
                const response = await fetch('http://localhost:8084/api/test-personalization', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        profile: profile,
                        test_questions: [
                            "Tell me about yourself",
                            "What's your experience with Python?",
                            "Describe a challenging project you worked on"
                        ]
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    showPersonalizationPreview(result);
                } else {
                    throw new Error('Test failed');
                }
            } catch (error) {
                showNotification('❌ Test failed: ' + error.message, 'error');
            }
        }

        function showPersonalizationPreview(result) {
            const previewSection = document.getElementById('previewSection');
            const personalizedExample = document.getElementById('personalizedExample');
            
            let html = '<div style="background: rgba(0,0,0,0.7); padding: 15px; border-radius: 8px;">';
            
            result.examples.forEach((example, index) => {
                html += `
                    <div style="margin: 15px 0; padding: 15px; background: rgba(0,255,0,0.1); border-radius: 5px;">
                        <strong>❓ Question:</strong> ${example.question}<br><br>
                        <strong>🤖 Personalized Answer:</strong><br>
                        <em>${example.answer}</em>
                    </div>
                `;
            });
            
            html += '</div>';
            personalizedExample.innerHTML = html;
            previewSection.style.display = 'block';
        }

        function gatherProfileData() {
            return {
                personal: {
                    fullName: document.getElementById('fullName').value,
                    currentRole: document.getElementById('currentRole').value,
                    experienceYears: document.getElementById('experienceYears').value,
                    location: document.getElementById('location').value,
                    currentCompany: document.getElementById('currentCompany').value,
                    industry: document.getElementById('industry').value,
                    careerGoals: document.getElementById('careerGoals').value
                },
                skills: {
                    selected: Array.from(selectedSkills),
                    additional: document.getElementById('additionalSkills').value.split(',').map(s => s.trim()).filter(s => s)
                },
                experience: {
                    keyProjects: document.getElementById('keyProjects').value,
                    achievements: document.getElementById('achievements').value,
                    challenges: document.getElementById('challenges').value
                },
                preferences: {
                    communicationStyle: document.getElementById('communicationStyle').value,
                    responseLength: document.getElementById('responseLength').value,
                    personalityTraits: document.getElementById('personalityTraits').value
                },
                resumeAnalyzed: resumeAnalyzed,
                lastUpdated: new Date().toISOString()
            };
        }

        function updateProfileStatus() {
            const profile = gatherProfileData();
            const statusSection = document.getElementById('profileStatus');
            
            let completeness = 0;
            let total = 0;
            
            // Check completeness
            if (profile.personal.fullName) completeness++; total++;
            if (profile.personal.currentRole) completeness++; total++;
            if (profile.personal.experienceYears) completeness++; total++;
            if (profile.skills.selected.length > 0) completeness++; total++;
            if (profile.experience.keyProjects) completeness++; total++;
            if (resumeAnalyzed) completeness++; total++;
            
            const percentage = Math.round((completeness / total) * 100);
            
            let status, className;
            if (percentage >= 80) {
                status = `✅ Profile ${percentage}% complete - Ready for personalized AI responses!`;
                className = 'status-success';
            } else if (percentage >= 50) {
                status = `⚠️ Profile ${percentage}% complete - Add more details for better personalization`;
                className = 'status-warning';
            } else {
                status = `❌ Profile ${percentage}% complete - Fill in more information`;
                className = 'status-error';
            }
            
            statusSection.innerHTML = `<span class="status-indicator ${className}"></span>${status}`;
        }

        async function loadExistingProfile() {
            try {
                const response = await fetch('http://localhost:8084/api/get-profile');
                if (response.ok) {
                    const profile = await response.json();
                    populateForm(profile);
                }
            } catch (error) {
                console.log('No existing profile found');
            }
        }

        function populateForm(profile) {
            // Populate personal information
            if (profile.personal) {
                Object.keys(profile.personal).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) element.value = profile.personal[key] || '';
                });
            }
            
            // Populate skills
            if (profile.skills && profile.skills.selected) {
                // Clear existing selections
                selectedSkills.clear();
                document.querySelectorAll('.skill-tag.selected').forEach(tag => {
                    tag.classList.remove('selected');
                });
                
                // Add new selections
                profile.skills.selected.forEach(skill => {
                    const skillTag = document.querySelector(`[data-skill="${skill}"]`);
                    if (skillTag) {
                        skillTag.classList.add('selected');
                        selectedSkills.add(skill);
                    }
                });
            }
            
            // Populate experience fields
            if (profile.experience) {
                const keyProjectsElement = document.getElementById('keyProjects');
                if (keyProjectsElement && profile.experience.keyProjects) {
                    keyProjectsElement.value = profile.experience.keyProjects;
                }
                
                const achievementsElement = document.getElementById('achievements');
                if (achievementsElement && profile.experience.achievements) {
                    achievementsElement.value = profile.experience.achievements;
                }
                
                const challengesElement = document.getElementById('challenges');
                if (challengesElement && profile.experience.challenges) {
                    challengesElement.value = profile.experience.challenges;
                }
            }
            
            // Populate preferences
            if (profile.preferences) {
                const commStyleElement = document.getElementById('communicationStyle');
                if (commStyleElement && profile.preferences.communicationStyle) {
                    commStyleElement.value = profile.preferences.communicationStyle;
                }
            }
            updateProfileStatus();
        }

        function exportProfile() {
            const profile = gatherProfileData();
            const dataStr = JSON.stringify(profile, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'ai_interview_profile.json';
            link.click();
            
            showNotification('📤 Profile exported successfully!', 'success');
        }

        function clearProfile() {
            if (confirm('Are you sure you want to clear all profile data?')) {
                localStorage.clear();
                location.reload();
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#00ff00' : '#ff6b6b'};
                color: black;
                padding: 15px 25px;
                border-radius: 8px;
                font-weight: bold;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        console.log('📄 Resume & Profile Manager loaded');
        console.log('🎯 Upload your resume and fill in your details for personalized AI responses!');
    </script>
</body>
</html>
